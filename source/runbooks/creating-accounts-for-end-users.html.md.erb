---
owner_slack: "#modernisation-platform"
title: Creating AWS Accounts for Teams
last_reviewed_on: 2022-12-14
review_in: 6 months
---

# <%= current_page.data.title %>

## Overview

Hereâ€™s an example of an account request, and the steps that were taken in order to create it.  There are links to pull requests and the stages they need to be opened and merged, as well as references and explanations as to why.

## Information Required

Customers will fill out the new-environment template via our public repository [here](https://github.com/ministryofjustice/modernisation-platform/issues/new/choose) and supply the required information.

|Attribute|Description|
---|---|
|Application name (file name)|The name must be in lowercase and a maximum of 30 characters. For our example we have `data-and-insights-wepi`|
|GitHub team slug|This is the name of your GitHub team that will be accessing the environment. Environments are accessed via single sign on (SSO), so to give people permissions to access your environment you just have to add them to your GitHub team.|
|Access|For our example, sandbox access has been requested. To read more about access levels, click [here](https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/creating-environments.html#application-name)|
|Environment|This is one of the four valid environments, development, test, preproduction or production|
|Tags| application, business-unit and owner are in tags, and they are used to tag your AWS resources inside of your account.|
|Additional features| This example has no additional features, but things VPN endpoints and extended DNS zones are requestable.|

## New Environment Files

#### 1. Create a new environment file 

`environments/$account-name.json`

See an example file [here](https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/creating-environments.html#example-json-files).

If you are adding an environment to an existing application you can add the new environment block to this file, you do not need to create another.

#### 2. Update the `expected.rego`

Update the [`expected.rego`](https://github.com/ministryofjustice/modernisation-platform/blob/main/policies/environments/expected.rego) file with the newly added account name.

This is to make sure that none of the json files gets accidentally deleted. This is going to be validated with the [opa-policies](https://github.com/ministryofjustice/modernisation-platform/blob/main/.github/workflows/opa-policies.yml) GitHub Actions workflow.

#### 3. Create a pull request

This will trigger the [`new-environment workflow`](https://github.com/ministryofjustice/modernisation-platform/blob/main/.github/workflows/new-environment.yml), which will run its check-environments-deployment-plan. You can see what will change in the output from GitHub Actions.

#### 4. Merge the pull request

This will run the [`new-environment` workflow](https://github.com/ministryofjustice/modernisation-platform/blob/main/.github/workflows/new-environment.yml) to create a new AWS account.

This will also run the [`new-environment-files` workflow](https://github.com/ministryofjustice/modernisation-platform/blob/main/.github/workflows/new-environment-files.yml) which generates two new pull requests:

1. One in the `modernisation-platform` repo which can be merged straight away, 
1. One in the `modernisation-platform-environments` repo, which is merged last (in the __Step 3__ of the __Network Stage__).

## Network Stage

For this example, we will be joining an existing subnet-set. For new business units, work will need to be done beforehand, however that's not the standard procedure and usually a one off. If you are working with a new business unit, read about the steps required [here.](https://user-guide.modernisation-platform.service.justice.gov.uk/runbooks/creating-vpcs.html)

#### Step one
Check that you have completed the previous steps, so far you should have added the github-slug, the json files under environments, updated the `policies/environments/expected.rego` file and merged the PR in modernisation-platform containing the terraform files.

#### Step two
Add the subnets in `environments/networks`. Update the [`policies/networking/expected.rego`](https://github.com/ministryofjustice/modernisation-platform/blob/main/policies/networking/expected.rego) to include newly added subnets (similarly to like you did for environments). This is to ensure that none of the subnets get accidentally deleted. Here's an example of a pull request for this [stage](https://github.com/ministryofjustice/modernisation-platform/pull/2127/files ).

This will then kick off `core-vpc-<env>-demployment` pipelines and run `terraform plan`, `terraform apply` and the `scripts/member-account-ram-association.sh` script for the RAM share. If the RAM share script fails to run on the merge, it will have to be run manually.

The pipeline will also generate a PR for the ram share, merge this. An example can be found [here](https://github.com/ministryofjustice/modernisation-platform/pull/2203)

#### Step three
Once complete, the pull request raised earlier in  `modernisation-platform-environments` can be merged. Example [here](https://github.com/ministryofjustice/modernisation-platform-environments/pull/805/files ). The pipeline will create this.

## Checking its creation

You should be able to see the account or accounts created [here](https://moj.awsapps.com/start/#/)

Logging into the account, you should be able to view the subnets, and be displayed with

![SSO main menu](../images/subnets.png)
